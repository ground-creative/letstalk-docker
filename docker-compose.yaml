version: '3'
services:
  app:
    container_name: ${CONTAINER_NAME}
    image: ${DOCKER_IMAGE}
    restart: ${RESTART}
    volumes:
      - type: bind
        source: ${VOLUME}
        target: ${WORK_DIR}
      - type: bind
        source: ./logs
        target: /logs
    build: 
      context: .
      dockerfile: ${DOCKER_FILE}
      args:
        DOCKER_IMAGE: ${DOCKER_IMAGE}
        VOLUME: ${VOLUME}
        WORK_DIR: ${WORK_DIR}
        APP_REPOSITORY_URL: ${APP_REPOSITORY_URL}
        USRID: ${USRID}
        GRPID: ${GRPID}
    environment:
    - "TEST=${TEST}"
    - "CONTAINER_NAME=${CONTAINER_NAME}"
    - "COMMAND=${COMMAND}"
    - "VOLUME=${VOLUME}"
    - "DOCKER_IMAGE=${DOCKER_IMAGE}"
    - "WORK_DIR=${WORK_DIR}"
    - "TZ=${TIMEZONE}"
    - "SERVER_ADDRESS=${SERVER_ADDRESS}"
    - "SERVER_PORT=${SERVER_PORT}"
    - "LOG_LEVEL=${LOG_LEVEL}"
    - "WEB_PANEL_ADDRESS=${WEB_PANEL_ADDRESS}"
    - "OPENVOICE_API_URL=${OPENVOICE_API_URL}"
    - "OLLAMA_API_URL=${OLLAMA_API_URL}"
    - "LMSTUDIO_API_URL=${LMSTUDIO_API_URL}"
    - "FAST_WHISPER_API_URL=${FAST_WHISPER_API_URL}"
    - "OPENAI_API_KEY=${OPENAI_API_KEY}"
    - "ELEVENLABS_API_KEY=${ELEVENLABS_API_KEY}"
    - "APP_REPOSITORY_URL=${APP_REPOSITORY_URL}"
    - "APP_SECRET_KEY=${APP_SECRET_KEY}"
    - "UPLOAD_FOLDER=${UPLOAD_FOLDER}"
    - "EXTERNAL_ADDRESS=${EXTERNAL_ADDRESS}"
    - "TWILIO_NUMBER=${TWILIO_NUMBER}"
    - "TWILIO_ACCOUNT_SID=${TWILIO_ACCOUNT_SID}"
    - "TWILIO_AUTH_TOKEN=${TWILIO_AUTH_TOKEN}"
    - "USRID=${USRID}"
    - "GRPID=${GRPID}"
    logging:
      driver: "${LOG_DRIVER}"
      options:
        tag: "{{.Name}}"
    ports:
      - "127.0.0.1:${SERVER_PORT}:${SERVER_PORT}"

networks:
  default:
    external:
      name: ${NETWORK_NAME}
    
